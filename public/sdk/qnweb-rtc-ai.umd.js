!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).QNRTCAI={})}(this,function(a){"use strict";n.set=function(e,t){this.cache[e]=t},n.get=function(e){return this.cache[e]},n.init=function(e,t){this.set("token",e),this.set("signCallback",t)},n.cache={};var c=n;function n(){}var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var s=function(){return(s=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function u(e,t){var n={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]]);return n}a.QNAudioToTextStatus=void 0,(i=a.QNAudioToTextStatus||(a.QNAudioToTextStatus={})).AVAILABLE="AVAILABLE",i.DESTROY="DESTROY",i.ERROR="ERROR",i.DETECTING="DETECTING",d.prototype.close=function(){var e=this;if(!this.ws)throw new Error("WebSocket is not initialized: ".concat(this.ws));this.status===a.QNAudioToTextStatus.DETECTING&&(this.status=a.QNAudioToTextStatus.DESTROY,this.ws.close(1e3,"eos"),setTimeout(function(){e.ws.close(),e.ws=null},500))},d.prototype.initWebSocket=function(e){var t=this,n=(console.log("AudioToTextAnalyzer initWebSocket"),e.params),o=e.callback,e=e.audioBuffer,r=s({aue:1,e:Math.floor(Date.now()/1e3),voice_sample:e.sampleRate||16e3},n),i="".concat("wss://ap-open-ws.service-z0.qiniuapp.com/v2/asr","?").concat(Object.keys(r).map(function(e){return"".concat(e,"=").concat(r[e])}).join("&"));Promise.resolve(c.get("signCallback")(i)).then(function(e){t.ws=new WebSocket("".concat(i,"&token=").concat(e||null)),t.ws.binaryType="arraybuffer",t.ws.addEventListener("open",function(e){console.log("AudioToTextAnalyzer open",e),t.isRecording=!0,t.status=a.QNAudioToTextStatus.DETECTING,null!=o&&o.onStatusChange&&o.onStatusChange(t.status,"正在实时转化")}),t.ws.addEventListener("message",function(e){e=new TextDecoder("utf-8").decode(e.data),e=JSON.parse(e);null!=o&&o.onAudioToText&&o.onAudioToText(e)}),t.ws.addEventListener("error",function(e){console.log("AudioToTextAnalyzer error",e),t.isRecording=!1,t.status=a.QNAudioToTextStatus.ERROR,null!=o&&o.onStatusChange&&o.onStatusChange(t.status,"连接异常断线")}),t.ws.addEventListener("close",function(e){console.log("AudioToTextAnalyzer close",e),t.isRecording=!1,t.status=a.QNAudioToTextStatus.DESTROY,null!=o&&o.onStatusChange&&o.onStatusChange(t.status,"已经销毁不可用")})})},d.prototype.sendMessageToWebSocket=function(e){this.leftDataList.push(e.getChannelData(0).slice(0)),200<=Date.now()-this.startTime&&(e=this.mergeArray(this.leftDataList),e=Int16Array.from(e.map(function(e){return 0<e?32767*e:32768*e})).buffer,this.ws.send(e),this.startTime=Date.now(),this.leftDataList=[],this.rightDataList=[])},d.prototype.mergeArray=function(e){for(var t=e.length*e[0].length,n=new Float32Array(t),o=0,r=0;r<e.length;r++)n.set(e[r],o),o+=e[r].length;return n},d.prototype.interleaveLeftAndRight=function(e,t){for(var n=e.length+t.length,o=new Float32Array(n),r=0;r<e.length;r++){var i=2*r;o[i]=e[r],o[1+i]=t[r]}return o},d.startAudioToText=function(e,t,n){function o(e){r.ws||r.initWebSocket({params:t,callback:n,audioBuffer:e}),r.status===a.QNAudioToTextStatus.DETECTING&&r.sendMessageToWebSocket(e)}var r=new this;r.startTime=Date.now();return e.on("audioFrame",o),r.audioBufferHandler=o,r.audioTrack=e,r},d.prototype.getStatus=function(){return this.status},d.prototype.stopAudioToText=function(){if(this.audioTrack&&this.audioBufferHandler&&this.audioTrack.off("audioFrame",this.audioBufferHandler),!this.ws)throw new Error("ws is ".concat(this.ws));this.close()};var i=d;function d(){this.status=a.QNAudioToTextStatus.AVAILABLE,this.isRecording=!1,this.startTime=Date.now(),this.leftDataList=[],this.rightDataList=[]}var l,f,m="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){if(f[e])return f[e].exports;var t=f[e]={i:e,l:!1,exports:{}};return l[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}l=[function(o,e,t){var h;function p(t){return["image/png","image/jpeg","image/gif"].some(e=>e===t)}t.r(e),t.d(e,"canvastoDataURL",function(){return m}),t.d(e,"canvastoFile",function(){return i}),t.d(e,"dataURLtoFile",function(){return g}),t.d(e,"dataURLtoImage",function(){return v}),t.d(e,"downloadFile",function(){return a}),t.d(e,"filetoDataURL",function(){return b}),t.d(e,"imagetoCanvas",function(){return w}),t.d(e,"urltoBlob",function(){return u}),t.d(e,"urltoImage",function(){return d}),t.d(e,"compress",function(){return l}),t.d(e,"compressAccurately",function(){return f}),t.d(e,"EImageType",function(){return h}),(t=h=h||{}).PNG="image/png",t.JPEG="image/jpeg",t.GIF="image/gif";var r=function(e,a,s,c){return new(s=s||Promise)(function(n,t){function o(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,r)}i((c=c.apply(e,a||[])).next())})};function m(e,t=.92,n=h.JPEG){return r(this,void 0,void 0,function*(){return p(n)||(n=h.JPEG),e.toDataURL(n,t)})}function i(e,n=.92,o=h.JPEG){return new Promise(t=>e.toBlob(e=>t(e),o,n))}var s=function(e,a,s,c){return new(s=s||Promise)(function(n,t){function o(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,r)}i((c=c.apply(e,a||[])).next())})};function g(i,a){return s(this,void 0,void 0,function*(){const e=i.split(",");let t=e[0].match(/:(.*?);/)[1];const n=atob(e[1]);let o=n.length;const r=new Uint8Array(o);for(;o--;)r[o]=n.charCodeAt(o);return p(a)&&(t=a),new Blob([r],{type:t})})}function v(o){return new Promise((e,t)=>{const n=new Image;n.onload=()=>e(n),n.onerror=()=>t(new Error("dataURLtoImage(): dataURL is illegal")),n.src=o})}function a(e,t){const n=document.createElement("a"),o=(n.href=window.URL.createObjectURL(e),n.download=t||Date.now().toString(36),document.body.appendChild(n),document.createEvent("MouseEvents"));o.initEvent("click",!1,!1),n.dispatchEvent(o),document.body.removeChild(n)}function b(n){return new Promise(t=>{const e=new FileReader;e.onloadend=e=>t(e.target.result),e.readAsDataURL(n)})}var c=function(e,a,s,c){return new(s=s||Promise)(function(n,t){function o(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,r)}i((c=c.apply(e,a||[])).next())})};function w(i,a={}){return c(this,void 0,void 0,function*(){const t=Object.assign({},a),e=document.createElement("canvas"),n=e.getContext("2d");let o,r;for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=Number(t[i]));if(t.scale){const a=0<t.scale&&t.scale<10?t.scale:1;r=i.width*a,o=i.height*a}else r=t.width||t.height*i.width/i.height||i.width,o=t.height||t.width*i.height/i.width||i.height;switch([5,6,7,8].some(e=>e===t.orientation)?(e.height=r,e.width=o):(e.height=o,e.width=r),t.orientation){case 3:n.rotate(180*Math.PI/180),n.drawImage(i,-e.width,-e.height,e.width,e.height);break;case 6:n.rotate(90*Math.PI/180),n.drawImage(i,0,-e.width,e.height,e.width);break;case 8:n.rotate(270*Math.PI/180),n.drawImage(i,-e.height,0,e.height,e.width);break;case 2:n.translate(e.width,0),n.scale(-1,1),n.drawImage(i,0,0,e.width,e.height);break;case 4:n.translate(e.width,0),n.scale(-1,1),n.rotate(180*Math.PI/180),n.drawImage(i,-e.width,-e.height,e.width,e.height);break;case 5:n.translate(e.width,0),n.scale(-1,1),n.rotate(90*Math.PI/180),n.drawImage(i,0,-e.width,e.height,e.width);break;case 7:n.translate(e.width,0),n.scale(-1,1),n.rotate(270*Math.PI/180),n.drawImage(i,-e.height,0,e.height,e.width);break;default:n.drawImage(i,0,0,e.width,e.height)}return e})}function u(e){return fetch(e).then(e=>e.blob())}function d(o){return new Promise((e,t)=>{const n=new Image;n.onload=()=>e(n),n.onerror=()=>t(new Error("urltoImage(): Image failed to load, please check the image URL")),n.src=o})}var n=function(e,a,s,c){return new(s=s||Promise)(function(n,t){function o(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,r)}i((c=c.apply(e,a||[])).next())})};function l(r,i={}){return n(this,void 0,void 0,function*(){if(!(r instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");if((i="object"!=typeof i?Object.assign({quality:i}):i).quality=Number(i.quality),Number.isNaN(i.quality))return r;const e=yield b(r);let t=e.split(",")[0].match(/:(.*?);/)[1],n=h.JPEG;p(i.type)&&(n=i.type,t=i.type);var o=yield g(yield m(yield w(yield v(e),Object.assign({},i)),i.quality,n),t);return o.size>r.size?r:o})}function f(l,f={}){return n(this,void 0,void 0,function*(){if(!(l instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");if((f="object"!=typeof f?Object.assign({size:f}):f).size=Number(f.size),Number.isNaN(f.size))return l;if(1024*f.size>l.size)return l;f.accuracy=Number(f.accuracy),(!f.accuracy||f.accuracy<.8||.99<f.accuracy)&&(f.accuracy=.95);const t=f.size*(2-f.accuracy)*1024,n=1024*f.size,o=f.size*f.accuracy*1024,e=yield b(l);let r=e.split(",")[0].match(/:(.*?);/)[1],i=h.JPEG;p(f.type)&&(i=f.type,r=f.type);var d=yield w(yield v(e),Object.assign({},f));let a,s=.5;const c=[null,null];for(let e=1;e<=7;e++){const f=.75*(a=yield m(d,s,i)).length;if(7===e){(t<f||o>f)&&(a=[a,...c].filter(e=>e).sort((e,t)=>Math.abs(.75*e.length-n)-Math.abs(.75*t.length-n))[0]);break}if(t<f)c[1]=a,s-=Math.pow(.5,e+1);else{if(!(o>f))break;c[0]=a,s+=Math.pow(.5,e+1)}}var u=yield g(a,r);return u.size>l.size?l:u})}}],f={},r.m=l,r.c=f,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var g,v=r(r.s=0),b=Error,w=R,e=b;if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function y(){this.constructor=w}function R(e,t){var n=b.call(this,t)||this;return n.code=e,n.error=t,n}function S(e,t){return function(){return e.apply(t,arguments)}}o(w,e),w.prototype=null===e?Object.create(e):(y.prototype=e.prototype,new y);const E=Object.prototype["toString"],k=Object["getPrototypeOf"],O=(g=Object.create(null),e=>{const t=E.call(e);return g[t]||(g[t]=t.slice(8,-1).toLowerCase())});var e=t=>(t=t.toLowerCase(),e=>O(e)===t),L=t=>e=>typeof e===t;const D=Array["isArray"],x=L("undefined");const U=e("ArrayBuffer");var M=L("string");const B=L("function"),j=L("number"),P=e=>null!==e&&"object"==typeof e;const F=e=>{if("object"!==O(e))return!1;var t=k(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)};var L=e("Date"),N=e("File"),I=e("Blob"),z=e("FileList"),_=e("URLSearchParams");function q(t,n,{allOwnKeys:o=!1}={}){if(null!=t){let e;var r;if("object"!=typeof t&&(t=[t]),D(t))for(e=0,r=t.length;e<r;e++)n.call(null,t[e],e,t);else{var i,a=o?Object.getOwnPropertyNames(t):Object.keys(t),s=a.length;for(e=0;e<s;e++)i=a[e],n.call(null,t[i],i,t)}}}W="undefined"!=typeof Uint8Array&&k(Uint8Array);var W,G,V=e=>W&&e instanceof W,H=e("HTMLFormElement"),Q=(G=[Object.prototype["hasOwnProperty"]][0],(e,t)=>G.call(e,t)),J=e("RegExp");const K=(n,o)=>{var e=Object.getOwnPropertyDescriptors(n);const r={};q(e,(e,t)=>{!1!==o(e,t,n)&&(r[t]=e)}),Object.defineProperties(n,r)};var h={isArray:D,isArrayBuffer:U,isBuffer:function(e){return null!==e&&!x(e)&&null!==e.constructor&&!x(e.constructor)&&B(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||E.call(e)===t||B(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&U(e.buffer)},isString:M,isNumber:j,isBoolean:e=>!0===e||!1===e,isObject:P,isPlainObject:F,isUndefined:x,isDate:L,isFile:N,isBlob:I,isRegExp:J,isFunction:B,isStream:e=>P(e)&&B(e.pipe),isURLSearchParams:_,isTypedArray:V,isFileList:z,forEach:q,merge:function n(){const o={};var r=(e,t)=>{F(o[t])&&F(e)?o[t]=n(o[t],e):F(e)?o[t]=n({},e):D(e)?o[t]=e.slice():o[t]=e};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&q(arguments[e],r);return o},extend:(n,e,o,{allOwnKeys:t}={})=>(q(e,(e,t)=>{o&&B(e)?n[t]=S(e,o):n[t]=e},{allOwnKeys:t}),n),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>e=65279===e.charCodeAt(0)?e.slice(1):e,inherits:(e,t,n,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,o)=>{var r,i;let a;const s={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),a=r.length;0<a--;)i=r[a],o&&!o(i,e,t)||s[i]||(t[i]=e[i],s[i]=!0)}while((e=!1!==n&&k(e))&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:O,kindOfTest:e,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;e=e.indexOf(t,n);return-1!==e&&e===n},toArray:e=>{if(!e)return null;if(D(e))return e;let t=e.length;if(!j(t))return null;const n=new Array(t);for(;0<t--;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=e&&e[Symbol.iterator],o=n.call(e);for(;(r=o.next())&&!r.done;){var r=r.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{var n;const o=[];for(;null!==(n=e.exec(t));)o.push(n);return o},isHTMLForm:H,hasOwnProperty:Q,hasOwnProp:Q,reduceDescriptors:K,freezeMethods:o=>{K(o,(e,t)=>{var n=o[t];B(n)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not read-only method '"+t+"'")}))})},toObjectSet:(e,t)=>{const n={};var o=e=>{e.forEach(e=>{n[e]=!0})};return D(e)?o(e):o(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[_-\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t)};function p(e,t,n,o,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),o&&(this.request=o),r&&(this.response=r)}h.inherits(p,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Y=p.prototype,$={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{$[e]={value:e}}),Object.defineProperties(p,$),Object.defineProperty(Y,"isAxiosError",{value:!0}),p.from=(e,t,n,o,r,i)=>{const a=Object.create(Y);return h.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),p.call(a,e.message,t,n,o,r),a.cause=e,a.name=e.name,i&&Object.assign(a,i),a};var X=("object"==typeof self?self:window).FormData;function Z(e){return h.isPlainObject(e)||h.isArray(e)}function ee(e){return h.endsWith(e,"[]")?e.slice(0,-2):e}function te(e,t,n){return e?e.concat(t).map(function(e,t){return e=ee(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}const ne=h.toFlatObject(h,{},null,function(e){return/^is[A-Z]/.test(e)});function oe(e,i,t){if(!h.isObject(e))throw new TypeError("target must be an object");i=i||new(X||FormData);const d=(t=h.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!h.isUndefined(t[e])})).metaTokens,r=t.visitor||o,a=t.dots,s=t.indexes;const n=(t.Blob||"undefined"!=typeof Blob&&Blob)&&((t=i)&&h.isFunction(t.append)&&"FormData"===t[Symbol.toStringTag]&&t[Symbol.iterator]);if(!h.isFunction(r))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(h.isDate(e))return e.toISOString();if(!n&&h.isBlob(e))throw new p("Blob is not supported. Use a Buffer instead.");return h.isArrayBuffer(e)||h.isTypedArray(e)?n&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function o(e,n,t){let o=e;if(e&&!t&&"object"==typeof e)if(h.endsWith(n,"{}"))n=d?n:n.slice(0,-2),e=JSON.stringify(e);else if(h.isArray(e)&&(r=e,h.isArray(r)&&!r.some(Z))||h.isFileList(e)||h.endsWith(n,"[]")&&(o=h.toArray(e)))return n=ee(n),o.forEach(function(e,t){h.isUndefined(e)||null===e||i.append(!0===s?te([n],t,a):null===s?n:n+"[]",c(e))}),!1;var r;return!!Z(e)||(i.append(te(t,n,a),c(e)),!1)}const u=[],l=Object.assign(ne,{defaultVisitor:o,convertValue:c,isVisitable:Z});if(!h.isObject(e))throw new TypeError("data must be an object");return function n(e,o){if(!h.isUndefined(e)){if(-1!==u.indexOf(e))throw Error("Circular reference detected in "+o.join("."));u.push(e),h.forEach(e,function(e,t){!0===(!(h.isUndefined(e)||null===e)&&r.call(i,e,h.isString(t)?t.trim():t,o,l))&&n(e,o?o.concat(t):[t])}),u.pop()}}(e),i}function re(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function ie(e,t){this._pairs=[],e&&oe(e,this,t)}const ae=ie.prototype;function se(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ce(e,t,n){if(!t)return e;var o=n&&n.encode||se;const r=n&&n.serialize;let i;return(i=r?r(t,n):h.isURLSearchParams(t)?t.toString():new ie(t,n).toString(o))&&(-1!==(t=e.indexOf("#"))&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i),e}ae.append=function(e,t){this._pairs.push([e,t])};class ue{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){h.forEach(this.handlers,function(e){null!==e&&t(e)})}}var de={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!(ae.toString=function(t){const n=t?function(e){return t.call(this,e,re)}:re;return this._pairs.map(function(e){return n(e[0])+"="+n(e[1])},"").join("&")})},M="undefined"!=typeof URLSearchParams?URLSearchParams:ie,L=FormData,I=("undefined"==typeof navigator||"ReactNative"!==(N=navigator.product)&&"NativeScript"!==N&&"NS"!==N)&&("undefined"!=typeof window&&"undefined"!=typeof document),le={isBrowser:!0,classes:{URLSearchParams:M,FormData:L,Blob:Blob},isStandardBrowserEnv:I,protocols:["http","https","file","blob","url","data"]};function fe(e){function s(e,t,n,o){let r=e[o++];var i=Number.isFinite(+r),a=o>=e.length;return r=!r&&h.isArray(n)?n.length:r,a?h.hasOwnProp(n,r)?n[r]=[n[r],t]:n[r]=t:(n[r]&&h.isObject(n[r])||(n[r]=[]),s(e,t,n[r],o)&&h.isArray(n[r])&&(n[r]=function(e){const t={};var n=Object.keys(e);let o;var r,i=n.length;for(o=0;o<i;o++)r=n[o],t[r]=e[r];return t}(n[r]))),!i}if(h.isFormData(e)&&h.isFunction(e.entries)){const n={};return h.forEachEntry(e,(e,t)=>{s(h.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0]),t,n,0)}),n}return null}var he=le.isStandardBrowserEnv?{write:function(e,t,n,o,r,i){const a=[];a.push(e+"="+encodeURIComponent(t)),h.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),h.isString(o)&&a.push("path="+o),h.isString(r)&&a.push("domain="+r),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){e=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function pe(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?(e=e,(n=t)?e.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):e):t;var n}var me=le.isStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a");let t;function r(e){let t=e;return n&&(o.setAttribute("href",t),t=o.href),o.setAttribute("href",t),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:"/"===o.pathname.charAt(0)?o.pathname:"/"+o.pathname}}return t=r(window.location.href),function(e){e=h.isString(e)?r(e):e;return e.protocol===t.protocol&&e.host===t.host}}():function(){return!0};function ge(e,t,n){p.call(this,null==e?"canceled":e,p.ERR_CANCELED,t,n),this.name="CanceledError"}h.inherits(ge,p,{__CANCEL__:!0});const ve=h.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);const be=Symbol("internals"),we=Symbol("defaults");function ye(e){return e&&String(e).trim().toLowerCase()}function Re(e){return!1===e||null==e?e:h.isArray(e)?e.map(Re):String(e)}function Se(e,t,n,o){return h.isFunction(o)?o.call(this,t,n):h.isString(t)&&(h.isString(o)?-1!==t.indexOf(o):h.isRegExp(o)&&o.test(t))}function Te(e,t){t=t.toLowerCase();var n=Object.keys(e);let o=n.length,r;for(;0<o--;)if(t===(r=n[o]).toLowerCase())return r;return null}function Ce(e,t){e&&this.set(e),this[we]=t||null}function Ae(a,s){let c=0;const u=function(i,a){i=i||10;const s=new Array(i),c=new Array(i);let u=0,d=0,l;return a=void 0!==a?a:1e3,function(e){var t=Date.now(),n=c[d];l=l||t,s[u]=e,c[u]=t;let o=d,r=0;for(;o!==u;)r+=s[o++],o%=i;if((u=(u+1)%i)===d&&(d=(d+1)%i),!(t-l<a))return e=n&&t-n,e?Math.round(1e3*r/e):void 0}}(50,250);return e=>{var t=e.loaded,e=e.lengthComputable?e.total:void 0,n=t-c,o=u(n),r=t<=e;const i={loaded:c=t,total:e,progress:e?t/e:void 0,bytes:n,rate:o||void 0,estimated:o&&e&&r?(e-t)/o:void 0};i[s?"download":"upload"]=!0,a(i)}}function Ee(f){return new Promise(function(d,r){var e=f.data;const t=Ce.from(f.headers).normalize(),i=f.responseType;let n;function a(){f.cancelToken&&f.cancelToken.unsubscribe(n),f.signal&&f.signal.removeEventListener("abort",n)}h.isFormData(e)&&le.isStandardBrowserEnv&&t.setContentType(!1);let s=new XMLHttpRequest;f.auth&&(o=f.auth.username||"",c=f.auth.password?unescape(encodeURIComponent(f.auth.password)):"",t.set("Authorization","Basic "+btoa(o+":"+c)));var o=pe(f.baseURL,f.url);function l(){if(s){var e=Ce.from("getAllResponseHeaders"in s&&s.getAllResponseHeaders()),e={data:i&&"text"!==i&&"json"!==i?s.response:s.responseText,status:s.status,statusText:s.statusText,headers:e,config:f,request:s};{var t=function(e){d(e),a()};var n=function(e){r(e),a()};const o=e.config.validateStatus;e.status&&o&&!o(e.status)?n(new p("Request failed with status code "+e.status,[p.ERR_BAD_REQUEST,p.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e)):t(e)}s=null}}s.open(f.method.toUpperCase(),ce(o,f.params,f.paramsSerializer),!0),s.timeout=f.timeout,"onloadend"in s?s.onloadend=l:s.onreadystatechange=function(){s&&4===s.readyState&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))&&setTimeout(l)},s.onabort=function(){s&&(r(new p("Request aborted",p.ECONNABORTED,f,s)),s=null)},s.onerror=function(){r(new p("Network Error",p.ERR_NETWORK,f,s)),s=null},s.ontimeout=function(){let e=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded";var t=f.transitional||de;f.timeoutErrorMessage&&(e=f.timeoutErrorMessage),r(new p(e,t.clarifyTimeoutError?p.ETIMEDOUT:p.ECONNABORTED,f,s)),s=null},!le.isStandardBrowserEnv||(c=(f.withCredentials||me(o))&&f.xsrfCookieName&&he.read(f.xsrfCookieName))&&t.set(f.xsrfHeaderName,c),void 0===e&&t.setContentType(null),"setRequestHeader"in s&&h.forEach(t.toJSON(),function(e,t){s.setRequestHeader(t,e)}),h.isUndefined(f.withCredentials)||(s.withCredentials=!!f.withCredentials),i&&"json"!==i&&(s.responseType=f.responseType),"function"==typeof f.onDownloadProgress&&s.addEventListener("progress",Ae(f.onDownloadProgress,!0)),"function"==typeof f.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",Ae(f.onUploadProgress)),(f.cancelToken||f.signal)&&(n=e=>{s&&(r(!e||e.type?new ge(null,f,s):e),s.abort(),s=null)},f.cancelToken&&f.cancelToken.subscribe(n),f.signal&&(f.signal.aborted?n():f.signal.addEventListener("abort",n)));var c,u=(c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(c=o))&&c[1]||"";u&&-1===le.protocols.indexOf(u)?r(new p("Unsupported protocol "+u+":",p.ERR_BAD_REQUEST,f)):s.send(e||null)})}Object.assign(Ce.prototype,{set:function(e,n,t){const r=this;function o(e,t,n){var o=ye(t);if(!o)throw new Error("header name must be a non-empty string");o=Te(r,o);o&&!0!==n&&(!1===r[o]||!1===n)||(r[o||t]=Re(e))}return h.isPlainObject(e)?h.forEach(e,(e,t)=>{o(e,t,n)}):o(n,e,t),this},get:function(e,t){if(e=ye(e)){e=Te(this,e);if(e){var n,o=this[e];if(!t)return o;if(!0!==t){if(h.isFunction(t))return t.call(this,o,e);if(h.isRegExp(t))return t.exec(o);throw new TypeError("parser must be boolean|regexp|function")}{var r=o;const i=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;for(;n=a.exec(r);)i[n[1]]=n[2];return i}}}},has:function(e,t){return!!(e=ye(e))&&!(!(e=Te(this,e))||t&&!Se(0,this[e],e,t))},delete:function(e,t){const n=this;let o=!1;function r(e){(e=ye(e))&&(!(e=Te(n,e))||t&&!Se(n,n[e],e,t)||(delete n[e],o=!0))}return h.isArray(e)?e.forEach(r):r(e),o},clear:function(){return Object.keys(this).forEach(this.delete.bind(this))},normalize:function(o){const r=this,i={};return h.forEach(this,(e,t)=>{var n=Te(i,t);if(n)return r[n]=Re(e),void delete r[t];n=o?t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n):String(t).trim();n!==t&&delete r[t],r[n]=Re(e),i[n]=!0}),this},toJSON:function(n){const o=Object.create(null);return h.forEach(Object.assign({},this[we]||null,this),(e,t)=>{null!=e&&!1!==e&&(o[t]=n&&h.isArray(e)?e.join(", "):e)}),o}}),Object.assign(Ce,{from:function(e){return h.isString(e)?new this((e=>{const t={};let n,o,r;return e&&e.split("\n").forEach(function(e){r=e.indexOf(":"),n=e.substring(0,r).trim().toLowerCase(),o=e.substring(r+1).trim(),!n||t[n]&&ve[n]||("set-cookie"===n?t[n]?t[n].push(o):t[n]=[o]:t[n]=t[n]?t[n]+", "+o:o)}),t})(e)):e instanceof this?e:new this(e)},accessor:function(e){const o=(this[be]=this[be]={accessors:{}}).accessors,a=this.prototype;function t(e){var t=ye(e);if(!o[t]){{var n=a;var r=e;const i=h.toCamelCase(" "+r);["get","set","has"].forEach(o=>{Object.defineProperty(n,o+i,{value:function(e,t,n){return this[o].call(this,r,e,t,n)},configurable:!0})})}o[t]=!0}}return h.isArray(e)?e.forEach(t):t(e),this}}),Ce.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent"]),h.freezeMethods(Ce.prototype),h.freezeMethods(Ce);const ke={http:Ee,xhr:Ee};var Oe=e=>{if(h.isString(e)){var t=ke[e];if(!e)throw Error(h.hasOwnProp(e)?`Adapter '${e}' is not available in the build`:`Can not resolve adapter '${e}'`);return t}if(!h.isFunction(e))throw new TypeError("adapter is not a function");return e};ke;const Le={"Content-Type":"application/x-www-form-urlencoded"};const De={transitional:de,adapter:function(){let e;return"undefined"!=typeof XMLHttpRequest?e=Oe("xhr"):"undefined"!=typeof process&&"process"===h.kindOf(process)&&(e=Oe("http")),e}(),transformRequest:[function(e,t){const n=t.getContentType()||"";var o=-1<n.indexOf("application/json"),r=h.isObject(e),i=(r&&h.isHTMLForm(e)&&(e=new FormData(e)),h.isFormData(e));if(i)return o?JSON.stringify(fe(e)):e;if(h.isArrayBuffer(e)||h.isBuffer(e)||h.isStream(e)||h.isFile(e)||h.isBlob(e))return e;if(h.isArrayBufferView(e))return e.buffer;if(h.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(r){if(-1<n.indexOf("application/x-www-form-urlencoded"))return i=e,a=this.formSerializer,oe(i,new le.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,o){return o.defaultVisitor.apply(this,arguments)}},a)).toString();if((i=h.isFileList(e))||-1<n.indexOf("multipart/form-data")){const s=this.env&&this.env.FormData;return oe(i?{"files[]":e}:e,s&&new s,this.formSerializer)}}if(r||o){t.setContentType("application/json",!1);var a=e,i=void 0,r=void 0;if(h.isString(a))try{return(i||JSON.parse)(a),h.trim(a)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(a)}return e}],transformResponse:[function(e){var t=this.transitional||De.transitional,n=t&&t.forcedJSONParsing,o="json"===this.responseType;if(e&&h.isString(e)&&(n&&!this.responseType||o)){n=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw p.from(e,p.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:le.classes.FormData,Blob:le.classes.Blob},validateStatus:function(e){return 200<=e&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};function xe(e,t){const n=this||De;var o=t||n;const r=Ce.from(o.headers);let i=o.data;return h.forEach(e,function(e){i=e.call(n,i,r.normalize(),t?t.status:void 0)}),r.normalize(),i}function Ue(e){return!(!e||!e.__CANCEL__)}function Me(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ge}function Be(t){Me(t),t.headers=Ce.from(t.headers),t.data=xe.call(t,t.transformRequest);const e=t.adapter||De.adapter;return e(t).then(function(e){return Me(t),e.data=xe.call(t,t.transformResponse,e),e.headers=Ce.from(e.headers),e},function(e){return Ue(e)||(Me(t),e&&e.response&&(e.response.data=xe.call(t,t.transformResponse,e.response),e.response.headers=Ce.from(e.response.headers))),Promise.reject(e)})}function je(t,n){n=n||{};const o={};function r(e,t){return h.isPlainObject(e)&&h.isPlainObject(t)?h.merge(e,t):h.isPlainObject(t)?h.merge({},t):h.isArray(t)?t.slice():t}function i(e){return h.isUndefined(n[e])?h.isUndefined(t[e])?void 0:r(void 0,t[e]):r(t[e],n[e])}function e(e){if(!h.isUndefined(n[e]))return r(void 0,n[e])}function a(e){return h.isUndefined(n[e])?h.isUndefined(t[e])?void 0:r(void 0,t[e]):r(void 0,n[e])}function s(e){return e in n?r(t[e],n[e]):e in t?r(void 0,t[e]):void 0}const c={url:e,method:e,data:e,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s};return h.forEach(Object.keys(t).concat(Object.keys(n)),function(e){const t=c[e]||i;var n=t(e);h.isUndefined(n)&&t!==s||(o[e]=n)}),o}h.forEach(["delete","get","head"],function(e){De.headers[e]={}}),h.forEach(["post","put","patch"],function(e){De.headers[e]=h.merge(Le)});const Pe={},Fe=(["object","boolean","number","function","string","symbol"].forEach((t,n)=>{Pe[t]=function(e){return typeof e===t||"a"+(n<1?"n ":" ")+t}}),{});Pe.transitional=function(o,r,n){function i(e,t){return"[Axios v1.1.3] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(e,t,n)=>{if(!1===o)throw new p(i(t," has been removed"+(r?" in "+r:"")),p.ERR_DEPRECATED);return r&&!Fe[t]&&(Fe[t]=!0,console.warn(i(t," has been deprecated since v"+r+" and will be removed in the near future"))),!o||o(e,t,n)}};var Ne={assertOptions:function(e,t,n){if("object"!=typeof e)throw new p("options must be an object",p.ERR_BAD_OPTION_VALUE);var o=Object.keys(e);let r=o.length;for(;0<r--;){var i=o[r];const s=t[i];if(s){var a=e[i],a=void 0===a||s(a,i,e);if(!0!==a)throw new p("option "+i+" must be "+a,p.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new p("Unknown option "+i,p.ERR_BAD_OPTION)}},validators:Pe};const Ie=Ne.validators;class ze{constructor(e){this.defaults=e,this.interceptors={request:new ue,response:new ue}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{};var{transitional:e,paramsSerializer:d}=t=je(this.defaults,t),e=(void 0!==e&&Ne.assertOptions(e,{silentJSONParsing:Ie.transitional(Ie.boolean),forcedJSONParsing:Ie.transitional(Ie.boolean),clarifyTimeoutError:Ie.transitional(Ie.boolean)},!1),void 0!==d&&Ne.assertOptions(d,{encode:Ie.function,serialize:Ie.function},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase(),t.headers&&h.merge(t.headers.common,t.headers[t.method]));e&&h.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),t.headers=new Ce(t.headers,e);const n=[];let o=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,n.unshift(e.fulfilled,e.rejected))});const r=[];this.interceptors.response.forEach(function(e){r.push(e.fulfilled,e.rejected)});let i,a=0,s;if(!o){const u=[Be.bind(this),void 0];for(u.unshift.apply(u,n),u.push.apply(u,r),s=u.length,i=Promise.resolve(t);a<s;)i=i.then(u[a++],u[a++]);return i}s=n.length;let c=t;for(a=0;a<s;){const l=n[a++],f=n[a++];try{c=l(c)}catch(e){f.call(this,e);break}}try{i=Be.call(this,c)}catch(e){return Promise.reject(e)}for(a=0,s=r.length;a<s;)i=i.then(r[a++],r[a++]);return i}getUri(e){return ce(pe((e=je(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}h.forEach(["delete","get","head","options"],function(n){ze.prototype[n]=function(e,t){return this.request(je(t||{},{method:n,url:e,data:(t||{}).data}))}}),h.forEach(["post","put","patch"],function(r){function e(o){return function(e,t,n){return this.request(je(n||{},{method:r,headers:o?{"Content-Type":"multipart/form-data"}:{},url:e,data:t}))}}ze.prototype[r]=e(),ze.prototype[r+"Form"]=e(!0)});const t=function t(n){var e=new ze(n);const o=S(ze.prototype.request,e);return h.extend(o,ze.prototype,e,{allOwnKeys:!0}),h.extend(o,e,null,{allOwnKeys:!0}),o.create=function(e){return t(je(n,e))},o}(De);t.Axios=ze,t.CanceledError=ge,t.CancelToken=class Dt{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let o;this.promise=new Promise(function(e){o=e});const r=this;this.promise.then(t=>{if(r._listeners){let e=r._listeners.length;for(;0<e--;)r._listeners[e](t);r._listeners=null}}),this.promise.then=e=>{let t;const n=new Promise(e=>{r.subscribe(e),t=e}).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e(function(e,t,n){r.reason||(r.reason=new ge(e,t,n),o(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){!this._listeners||-1!==(e=this._listeners.indexOf(e))&&this._listeners.splice(e,1)}static source(){let t;return{token:new Dt(function(e){t=e}),cancel:t}}},t.isCancel=Ue,t.VERSION="1.1.3",t.toFormData=oe,t.AxiosError=p,t.Cancel=t.CanceledError,t.all=function(e){return Promise.all(e)},t.spread=function(t){return function(e){return t.apply(null,e)}},t.isAxiosError=function(e){return h.isObject(e)&&!0===e.isAxiosError},t.formToJSON=e=>fe(h.isHTMLForm(e)?new FormData(e):e);var _e=t.create({baseURL:"https://ap-open-z0.qiniuapi.com/dora-sdk/api"}),qe=(_e.interceptors.request.use(function(e){var t=s(s({},e),{headers:s(s({},e.headers),{Authorization:c.get("token"),"Content-Type":"application/json"})});return"post"===e.method.toLowerCase()?s(s({},t),{data:{request:e.data}}):t},function(e){return Promise.reject(e)}),_e.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)}),We.run=function(e,t){e=function(e,t){for(var n=(e=e.split(","))[0].match(/:(.*?);/)[1],o=atob(e[1]),r=o.length,i=new Uint8Array(r);r--;)i[r]=o.charCodeAt(r);return new File([i],t,{type:n})}(e.getCurrentFrameData(),"photo");return v.compressAccurately(e,24).then(function(e){return n=e,new Promise(function(e){var t=new FileReader;t.readAsDataURL(n),t.onload=function(){e(t.result)}});var n}).then(function(e){return _e.post("/face-hdphotoauth",s({photo_b64:e.split(",")[1]},t))})},We);function We(){}J={exports:{}},_=J;function T(n,r){if(!n)throw"First parameter is required.";r=new Ge(n,r=r||{type:"video"});var i=this;function l(e){e&&(r.initCallback=function(){e(),e=r.initCallback=null});var t=new Ve(n,r);(c=new t(n,r)).record(),s("recording"),r.disableLogs||console.log("Initialized recorderType:",c.constructor.name,"for output-type:",r.type)}function t(o){if(o=o||function(){},c){if("paused"===i.state)return i.resumeRecording(),void setTimeout(function(){t(o)},1);"recording"===i.state||r.disableLogs||console.warn('Recording state should be: "recording", however current state is: ',i.state),r.disableLogs||console.log("Stopped recording "+r.type+" stream."),"gif"!==r.type?c.stop(e):(c.stop(),e()),s("stopped")}else u();function e(e){if(c){Object.keys(c).forEach(function(e){"function"!=typeof c[e]&&(i[e]=c[e])});var t,n=c.blob;if(!n){if(!e)throw"Recording failed.";c.blob=n=e}if(n&&!r.disableLogs&&console.log(n.type,"->",nt(n.size)),o){try{t=C.createObjectURL(n)}catch(e){}"function"==typeof o.call?o.call(i,t):o(t)}r.autoWriteToDisk&&a(function(e){var t={};t[r.type+"Blob"]=e,mt.Store(t)})}else"function"==typeof o.call?o.call(i,""):o("")}}function f(e){postMessage((new FileReaderSync).readAsDataURL(e))}function a(t,e){if(!t)throw"Pass a callback function over getDataURL.";var n,o=(e||c||{}).blob;if(!o)return r.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){a(t,e)},1e3);"undefined"==typeof Worker||navigator.mozGetUserMedia?((n=new FileReader).readAsDataURL(o),n.onload=function(e){t(e.target.result)}):((n=function(e){try{var t=C.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),n=new Worker(t);return C.revokeObjectURL(t),n}catch(e){}}(f)).onmessage=function(e){t(e.data)},n.postMessage(o))}function o(e){e=e||0,"paused"!==i.state?"stopped"!==i.state&&(e>=i.recordingDuration?t(i.onRecordingStopped):(e+=1e3,setTimeout(function(){o(e)},1e3))):setTimeout(function(){o(e)},1e3)}function s(e){i&&(i.state=e,"function"==typeof i.onStateChanged.call?i.onStateChanged.call(i,e):i.onStateChanged(e))}var c,e='It seems that recorder is destroyed or "startRecording" is not invoked for '+r.type+" recorder.";function u(){!0!==r.disableLogs&&console.warn(e)}var h,d={startRecording:function(e){return r.disableLogs||console.log("RecordRTC version: ",i.version),(r=e?new Ge(n,e):r).disableLogs||console.log("started recording "+r.type+" stream."),c?(c.clearRecordedData(),c.record(),s("recording"),i.recordingDuration&&o()):l(function(){i.recordingDuration&&o()}),i},stopRecording:t,pauseRecording:function(){c?"recording"===i.state?(s("paused"),c.pause(),r.disableLogs||console.log("Paused recording.")):r.disableLogs||console.warn("Unable to pause the recording. Recording state: ",i.state):u()},resumeRecording:function(){c?"paused"===i.state?(s("recording"),c.resume(),r.disableLogs||console.log("Resumed recording.")):r.disableLogs||console.warn("Unable to resume the recording. Recording state: ",i.state):u()},initRecorder:l,setRecordingDuration:function(e,t){if(void 0===e)throw"recordingDuration is required.";if("number"!=typeof e)throw"recordingDuration must be a number.";return i.recordingDuration=e,i.onRecordingStopped=t||function(){},{onRecordingStopped:function(e){i.onRecordingStopped=e}}},clearRecordedData:function(){c?(c.clearRecordedData(),r.disableLogs||console.log("Cleared old recorded data.")):u()},getBlob:function(){if(c)return c.blob;u()},getDataURL:a,toURL:function(){if(c)return C.createObjectURL(c.blob);u()},getInternalRecorder:function(){return c},save:function(e){c?ot(c.blob,e):u()},getFromDisk:function(e){c?T.getFromDisk(r.type,e):u()},setAdvertisementArray:function(e){r.advertisement=[];for(var t=e.length,n=0;n<t;n++)r.advertisement.push({duration:n,image:e[n]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){"recording"!==i.state||r.disableLogs||console.warn("Stop an active recorder."),c&&"function"==typeof c.clearRecordedData&&c.clearRecordedData(),c=null,s("inactive"),i.blob=null},onStateChanged:function(e){r.disableLogs||console.log("Recorder state changed:",e)},state:"inactive",getState:function(){return i.state},destroy:function(){var e=r.disableLogs;r={disableLogs:!0},i.reset(),s("destroyed"),d=i=null,at.AudioContextConstructor&&(at.AudioContextConstructor.close(),at.AudioContextConstructor=null),r.disableLogs=e,r.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return i=d;for(h in d)this[h]=d[h];return i=this,d}function Ge(e,t){return t.recorderType||t.type||(t.audio&&t.video?t.type="video":t.audio&&!t.video&&(t.type="audio")),t.recorderType&&!t.type&&(t.recorderType===lt||t.recorderType===dt||void 0!==wt&&t.recorderType===wt?t.type="video":t.recorderType===gt?t.type="gif":t.recorderType===ut?t.type="audio":t.recorderType===ct&&(A(e,"audio").length&&A(e,"video").length||!A(e,"audio").length&&A(e,"video").length?t.type="video":A(e,"audio").length&&!A(e,"video").length&&(t.type="audio"))),void 0!==ct&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(t.mimeType||(t.mimeType="video/webm"),t.type||(t.type=t.mimeType.split("/")[0]),t.bitsPerSecond),t.type||(t.mimeType&&(t.type=t.mimeType.split("/")[0]),t.type||(t.type="audio")),t}function Ve(e,t){var n;return(Ze||Ye||$e)&&(n=ut),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!Ze&&(n=ct),"video"===t.type&&(Ze||$e)&&(n=lt,void 0!==wt&&"undefined"!=typeof ReadableStream&&(n=wt)),"gif"===t.type&&(n=gt),"canvas"===t.type&&(n=dt),st()&&n!==dt&&n!==gt&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(A(e,"video").length||A(e,"audio").length)&&("audio"===t.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(n=ct):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(n=ct)),e instanceof Array&&e.length&&(n=bt),t.recorderType&&(n=t.recorderType),!t.disableLogs&&n&&n.name&&console.log("Using recorderType:",n.name||n.constructor.name),n=!n&&et?ct:n}function He(a){this.addStream=function(e){e&&(a=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var e,t,n,o,r=this.mediaType,i=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof r.audio&&st()&&!A(a,"audio").length&&(r.audio=!1),"function"!=typeof r.video&&st()&&!A(a,"video").length&&(r.video=!1),"function"!=typeof r.gif&&st()&&!A(a,"video").length&&(r.gif=!1),!r.audio&&!r.video&&!r.gif)throw"MediaStream must have either audio or video tracks.";r.audio&&(e=null,"function"==typeof r.audio&&(e=r.audio),this.audioRecorder=new T(a,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:e,mimeType:i.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),r.video||this.audioRecorder.startRecording()),r.video&&(e=null,"function"==typeof r.video&&(e=r.video),t=a,st()&&r.audio&&"function"==typeof r.audio&&(o=A(a,"video")[0],Xe?((t=new tt).addTrack(o),e&&e===lt&&(e=ct)):(t=new tt).addTrack(o)),this.videoRecorder=new T(t,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:e,mimeType:i.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),r.audio||this.videoRecorder.startRecording()),r.audio&&r.video&&(n=this,o=!0===st(),!0===(o=r.audio instanceof ut&&r.video||!0!==r.audio&&!0!==r.video&&r.audio!==r.video?!1:o)?(n.audioRecorder=null,n.videoRecorder.startRecording()):n.videoRecorder.initRecorder(function(){n.audioRecorder.initRecorder(function(){n.videoRecorder.startRecording(),n.audioRecorder.startRecording()})})),r.gif&&(e=null,"function"==typeof r.gif&&(e=r.gif),this.gifRecorder=new T(a,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:e,mimeType:i.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(t){t=t||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(e){t(e,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(e){t(e,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(e){t(e,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(n){function o(e,t){var n;"undefined"!=typeof Worker?((n=function(e){var t,e=C.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),n=new Worker(e);if(void 0!==C)t=C;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";t=webkitURL}return t.revokeObjectURL(e),n}(function(e){postMessage((new FileReaderSync).readAsDataURL(e))})).onmessage=function(e){t(e.data)},n.postMessage(e)):((n=new FileReader).readAsDataURL(e),n.onload=function(e){t(e.target.result)})}this.getBlob(function(e){e.audio&&e.video?o(e.audio,function(t){o(e.video,function(e){n({audio:t,video:e})})}):e.audio?o(e.audio,function(e){n({audio:e})}):e.video&&o(e.video,function(e){n({video:e})})})},this.writeToDisk=function(){T.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){(e=e||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}T.version="5.6.2",(_.exports=T).getFromDisk=function(n,o){if(!o)throw"callback is mandatory.";console.log("Getting recorded "+("all"===n?"blobs":n+" blob ")+" from disk!"),mt.Fetch(function(e,t){"all"!==n&&t===n+"Blob"&&o&&o(e),"all"===n&&o&&o(e,t.replace("Blob",""))})},T.writeToDisk=function(e){console.log("Writing recorded blob(s) to disk!"),(e=e||{}).audio&&e.video&&e.gif?e.audio.getDataURL(function(n){e.video.getDataURL(function(t){e.gif.getDataURL(function(e){mt.Store({audioBlob:n,videoBlob:t,gifBlob:e})})})}):e.audio&&e.video?e.audio.getDataURL(function(t){e.video.getDataURL(function(e){mt.Store({audioBlob:t,videoBlob:e})})}):e.audio&&e.gif?e.audio.getDataURL(function(t){e.gif.getDataURL(function(e){mt.Store({audioBlob:t,gifBlob:e})})}):e.video&&e.gif?e.video.getDataURL(function(t){e.gif.getDataURL(function(e){mt.Store({videoBlob:t,gifBlob:e})})}):e.audio?e.audio.getDataURL(function(e){mt.Store({audioBlob:e})}):e.video?e.video.getDataURL(function(e){mt.Store({videoBlob:e})}):e.gif&&e.gif.getDataURL(function(e){mt.Store({gifBlob:e})})},He.getFromDisk=T.getFromDisk,He.writeToDisk=T.writeToDisk,void 0!==T&&(T.MRecordRTC=He),(V=void 0!==m?m:null)&&"undefined"==typeof window&&void 0!==m&&(m.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},m.console||(m.console={}),void 0!==m.console.log&&void 0!==m.console.error||(m.console.error=m.console.log=m.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(V.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},V.HTMLVideoElement=function(){}),"undefined"==typeof location&&(V.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(V.screen={width:0,height:0}),void 0===C&&(V.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),V.window=m);var Qe,Je=window.requestAnimationFrame,Ke=(void 0===Je&&("undefined"!=typeof webkitRequestAnimationFrame?Je=webkitRequestAnimationFrame:"undefined"!=typeof mozRequestAnimationFrame?Je=mozRequestAnimationFrame:"undefined"!=typeof msRequestAnimationFrame?Je=msRequestAnimationFrame:void 0===Je&&(Qe=0,Je=function(e,t){var n=(new Date).getTime(),o=Math.max(0,16-(n-Qe)),r=setTimeout(function(){e(n+o)},o);return Qe=n+o,r})),window.cancelAnimationFrame),V=(void 0===Ke&&("undefined"!=typeof webkitCancelAnimationFrame?Ke=webkitCancelAnimationFrame:"undefined"!=typeof mozCancelAnimationFrame?Ke=mozCancelAnimationFrame:"undefined"!=typeof msCancelAnimationFrame?Ke=msCancelAnimationFrame:void 0===Ke&&(Ke=function(e){clearTimeout(e)})),window.AudioContext),C=(void 0===V&&("undefined"!=typeof webkitAudioContext&&(V=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(V=mozAudioContext)),window.URL),Ye=(void 0===C&&"undefined"!=typeof webkitURL&&(C=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia)),!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob)),$e=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),Xe=-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&"netscape"in window&&/ rv:/.test(navigator.userAgent),Ze=!$e&&!Ye&&!!navigator.webkitGetUserMedia||rt()||-1!==navigator.userAgent.toLowerCase().indexOf("chrome/"),et=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),tt=(et&&!Ze&&-1!==navigator.userAgent.indexOf("CriOS")&&(Ze=!(et=!1)),window.MediaStream);function nt(e){if(0===e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}function ot(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(e){}var n=(e.type||"video/webm").split("/")[1],o=(-1!==n.indexOf(";")&&(n=n.split(";")[0]),t&&-1!==t.indexOf(".")&&(t=(o=t.split("."))[0],n=o[1]),(t||Math.round(9999999999*Math.random())+888888888)+"."+n);if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,o);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(e,o);t=document.createElement("a");t.href=C.createObjectURL(e),t.download=o,t.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(t),"function"==typeof t.click?t.click():(t.target="_blank",t.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),C.revokeObjectURL(t.href)}function rt(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||(!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&0<=navigator.userAgent.indexOf("Electron"))}function A(e,t){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(t||"audio")}):[]}function it(e,t){!("srcObject"in t)&&"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e}void 0!==(tt=void 0===tt&&"undefined"!=typeof webkitMediaStream?webkitMediaStream:tt)&&void 0===tt.prototype.stop&&(tt.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})}),void 0!==T&&(T.invokeSaveAsDialog=ot,T.getTracks=A,T.getSeekableBlob=function(e,o){if("undefined"==typeof EBML)throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var r=new EBML.Reader,i=new EBML.Decoder,a=EBML.tools,t=new FileReader;t.onload=function(e){i.decode(this.result).forEach(function(e){r.read(e)}),r.stop();var t=a.makeMetadataSeekable(r.metadatas,r.duration,r.cues),n=this.result.slice(r.metadataSize),t=new Blob([t,n],{type:"video/webm"});o(t)},t.readAsArrayBuffer(e)},T.bytesToSize=nt,T.isElectron=rt);var at={};function st(){if(Xe||et||Ye)return!0;var e,t=navigator.userAgent,n=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10);return(Ze||$e)&&(e=t.indexOf("Chrome"),n=t.substring(e+7)),-1!==(t=(n=-1!==(t=n.indexOf(";"))?n.substring(0,t):n).indexOf(" "))&&(n=n.substring(0,t)),o=parseInt(""+n,10),isNaN(o)&&(n=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10)),49<=o}function ct(n,o){var e,r=this;if(void 0===n)throw'First argument "MediaStream" is required.';if("undefined"==typeof MediaRecorder)throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";"audio"===(o=o||{mimeType:"video/webm"}).type&&(A(n,"video").length&&A(n,"audio").length&&(navigator.mozGetUserMedia?(e=new tt).addTrack(A(n,"audio")[0]):e=new tt(A(n,"audio")),n=e),o.mimeType&&-1!==o.mimeType.toString().toLowerCase().indexOf("audio")||(o.mimeType=Ze?"audio/webm":"audio/ogg"),o.mimeType&&"audio/ogg"!==o.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(o.mimeType="audio/ogg"));var i,a=[];function s(){r.timestamps.push((new Date).getTime()),"function"==typeof o.onTimeStamp&&o.onTimeStamp(r.timestamps[r.timestamps.length-1],r.timestamps)}function c(e){return i&&i.mimeType?i.mimeType:e.mimeType||"video/webm"}function t(){a=[],i=null,r.timestamps=[]}this.getArrayOfBlobs=function(){return a},this.record=function(){r.blob=null,r.clearRecordedData(),r.timestamps=[],u=[],a=[];var t=o;o.disableLogs||console.log("Passing following config over MediaRecorder API.",t),i=i&&null,Ze&&!st()&&(t="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&t.mimeType&&(MediaRecorder.isTypeSupported(t.mimeType)||(o.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",t.mimeType),t.mimeType="audio"===o.type?"audio/webm":"video/webm"));try{i=new MediaRecorder(n,t),o.mimeType=t.mimeType}catch(e){i=new MediaRecorder(n)}t.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in i&&!1===i.canRecordMimeType(t.mimeType)&&(o.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",t.mimeType)),i.ondataavailable=function(e){e.data&&u.push("ondataavailable: "+nt(e.data.size)),"number"!=typeof o.timeSlice?!e.data||!e.data.size||e.data.size<100||r.blob?r.recordingCallback&&(r.recordingCallback(new Blob([],{type:c(t)})),r.recordingCallback=null):(r.blob=o.getNativeBlob?e.data:new Blob([e.data],{type:c(t)}),r.recordingCallback&&(r.recordingCallback(r.blob),r.recordingCallback=null)):e.data&&e.data.size&&(a.push(e.data),s(),"function"==typeof o.ondataavailable&&(e=o.getNativeBlob?e.data:new Blob([e.data],{type:c(t)}),o.ondataavailable(e)))},i.onstart=function(){u.push("started")},i.onpause=function(){u.push("paused")},i.onresume=function(){u.push("resumed")},i.onstop=function(){u.push("stopped")},i.onerror=function(e){e&&(e.name||(e.name="UnknownError"),u.push("error: "+e),o.disableLogs||(-1!==e.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",e):-1!==e.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",t.mimeType,") is not supported.",e):-1!==e.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",e):"OutOfMemory"===e.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"IllegalStreamModification"===e.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"OtherRecordingError"===e.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"GenericError"===e.name?console.error("The UA cannot provide the codec or recording option that has been requested.",e):console.error("MediaRecorder Error",e)),!r.manuallyStopped&&i&&"inactive"===i.state?(delete o.timeslice,i.start(6e5)):setTimeout(void 0,1e3),"inactive"!==i.state&&"stopped"!==i.state&&i.stop())},"number"==typeof o.timeSlice?(s(),i.start(o.timeSlice)):i.start(36e5),o.initCallback&&o.initCallback()},this.timestamps=[],this.stop=function(e){e=e||function(){},r.manuallyStopped=!0,i&&(this.recordingCallback=e,"recording"===i.state&&i.stop(),"number"==typeof o.timeSlice&&setTimeout(function(){r.blob=new Blob(a,{type:c(o)}),r.recordingCallback(r.blob)},100))},this.pause=function(){i&&"recording"===i.state&&i.pause()},this.resume=function(){i&&"paused"===i.state&&i.resume()},this.clearRecordedData=function(){i&&"recording"===i.state&&r.stop(t),t()},this.getInternalRecorder=function(){return i},this.blob=null,this.getState=function(){return i&&i.state||"inactive"};var u=[],r=(this.getAllStates=function(){return u},void 0===o.checkForInactiveTracks&&(o.checkForInactiveTracks=!1),this);!function e(){if(i&&!1!==o.checkForInactiveTracks)return!1===function(){if("active"in n){if(!n.active)return!1}else if("ended"in n&&n.ended)return!1;return!0}()?(o.disableLogs||console.log("MediaStream seems stopped."),void r.stop()):void setTimeout(e,1e3)}(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}function ut(t,o){if(!A(t,"audio").length)throw"Your stream has no audio tracks.";var r,i=this,f=[],h=[],a=!1,s=0,c=2,p=(o=o||{}).desiredSampRate;function m(){if(!1===o.checkForInactiveTracks)return!0;if("active"in t){if(!t.active)return!1}else if("ended"in t&&t.ended)return!1;return!0}function g(e,t){function n(e,d){var t,n=e.numberOfAudioChannels,o=e.leftBuffers.slice(0),r=e.rightBuffers.slice(0),i=e.sampleRate,a=e.internalInterleavedLength,e=e.desiredSampRate;function s(e,t,n){var o=Math.round(e.length*(t/n)),r=[],d=Number((e.length-1)/(o-1));r[0]=e[0];for(var i,a=1;a<o-1;a++){var s=a*d,c=Number(Math.floor(s)).toFixed(),u=Number(Math.ceil(s)).toFixed();r[a]=(i=e[c],u=e[u],i+(u-i)*(s-c))}return r[o-1]=e[e.length-1],r}function l(e,t){for(var n=new Float64Array(t),o=0,r=e.length,i=0;i<r;i++){var a=e[i];n.set(a,o),o+=a.length}return n}function c(e,t,n){for(var o=n.length,r=0;r<o;r++)e.setUint8(t+r,n.charCodeAt(r))}2===n&&(o=l(o,a),r=l(r,a),e&&(o=s(o,e,i),r=s(r,e,i))),1===n&&(o=l(o,a),e&&(o=s(o,e,i))),e&&(i=e),2===n&&(t=function(e,t){for(var n=e.length+t.length,o=new Float64Array(n),r=0,i=0;i<n;)o[i++]=e[r],o[i++]=t[r],r++;return o}(o,r));for(var a=(t=1===n?o:t).length,e=new ArrayBuffer(44+2*a),u=new DataView(e),f=(c(u,0,"RIFF"),u.setUint32(4,36+2*a,!0),c(u,8,"WAVE"),c(u,12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,1,!0),u.setUint16(22,n,!0),u.setUint32(24,i,!0),u.setUint32(28,i*n*2,!0),u.setUint16(32,2*n,!0),u.setUint16(34,16,!0),c(u,36,"data"),u.setUint32(40,2*a,!0),a),h=44,p=0;p<f;p++)u.setInt16(h,32767*t[p],!0),h+=2;if(d)return d({buffer:e,view:u});postMessage({buffer:e,view:u})}var o,r,i;e.noWorker?n(e,function(e){t(e.buffer,e.view)}):(r=n,r=C.createObjectURL(new Blob([r.toString(),";this.onmessage =  function (eee) {"+r.name+"(eee.data);}"],{type:"application/javascript"})),(i=new Worker(r)).workerURL=r,(o=i).onmessage=function(e){t(e.data.buffer,e.data.view),C.revokeObjectURL(o.workerURL),o.terminate()},o.postMessage(e))}!0===o.leftChannel&&(c=1),(!(c=1===o.numberOfAudioChannels?1:c)||c<1)&&(c=2),o.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+c),void 0===o.checkForInactiveTracks&&(o.checkForInactiveTracks=!0),this.record=function(){if(!1===m())throw"Please make sure MediaStream is active.";w(),R=b=!1,a=!0,void 0!==o.timeSlice&&S()},this.stop=function(n){n=n||function(){},a=!1,g({desiredSampRate:p,sampleRate:v,numberOfAudioChannels:c,internalInterleavedLength:s,leftBuffers:f,rightBuffers:1===c?[]:h,noWorker:o.noWorker},function(e,t){i.blob=new Blob([t],{type:"audio/wav"}),i.buffer=new ArrayBuffer(t.buffer.byteLength),i.view=t,i.sampleRate=p||v,i.bufferSize=d,i.length=s,R=!1,n&&n(i.blob)})},(T.Storage=void 0===T.Storage?{AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}:T.Storage).AudioContextConstructor&&"closed"!==T.Storage.AudioContextConstructor.state||(T.Storage.AudioContextConstructor=new T.Storage.AudioContext);var e=T.Storage.AudioContextConstructor,u=e.createMediaStreamSource(t),n=[0,256,512,1024,2048,4096,8192,16384],d=void 0===o.bufferSize?4096:o.bufferSize;if(-1===n.indexOf(d)&&(o.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(n,null,"\t"))),e.createJavaScriptNode)r=e.createJavaScriptNode(d,c,c);else{if(!e.createScriptProcessor)throw"WebAudio API has no support on this browser.";r=e.createScriptProcessor(d,c,c)}u.connect(r),o.bufferSize||(d=r.bufferSize);var v=void 0!==o.sampleRate?o.sampleRate:e.sampleRate||44100,b=((v<22050||96e3<v)&&(o.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),o.disableLogs||o.desiredSampRate&&console.log("Desired sample-rate: "+o.desiredSampRate),!1);function w(){f=[],s=0,b=a=R=!(h=[]),e=null,i.leftchannel=f,i.rightchannel=h,i.numberOfAudioChannels=c,i.desiredSampRate=p,i.sampleRate=v,i.recordingLength=s,l={left:[],right:[],recordingLength:0}}function y(){r&&(r.onaudioprocess=null,r.disconnect(),r=null),u&&(u.disconnect(),u=null),w()}this.pause=function(){b=!0},this.resume=function(){if(!1===m())throw"Please make sure MediaStream is active.";if(!a)return o.disableLogs||console.log("Seems recording has been restarted."),void this.record();b=!1},this.clearRecordedData=function(){o.checkForInactiveTracks=!1,a&&this.stop(y),y()},this.name="StereoAudioRecorder";var R=!(this.toString=function(){return this.name});r.onaudioprocess=function(e){var t,n;b||(!1===m()&&(o.disableLogs||console.log("MediaStream seems stopped."),r.disconnect(),a=!1),a?(R||(R=!0,o.onAudioProcessStarted&&o.onAudioProcessStarted(),o.initCallback&&o.initCallback()),t=e.inputBuffer.getChannelData(0),t=new Float32Array(t),f.push(t),2===c&&(e=e.inputBuffer.getChannelData(1),n=new Float32Array(e),h.push(n)),s+=d,i.recordingLength=s,void 0!==o.timeSlice&&(l.recordingLength+=d,l.left.push(t),2===c&&l.right.push(n))):u&&(u.disconnect(),u=null))},e.createMediaStreamDestination?r.connect(e.createMediaStreamDestination()):r.connect(e.destination),this.leftchannel=f,this.rightchannel=h,this.numberOfAudioChannels=c,this.desiredSampRate=p,this.sampleRate=v,i.recordingLength=s;var l={left:[],right:[],recordingLength:0};function S(){a&&"function"==typeof o.ondataavailable&&void 0!==o.timeSlice&&(l.left.length?(g({desiredSampRate:p,sampleRate:v,numberOfAudioChannels:c,internalInterleavedLength:l.recordingLength,leftBuffers:l.left,rightBuffers:1===c?[]:l.right},function(e,t){t=new Blob([t],{type:"audio/wav"});o.ondataavailable(t),setTimeout(S,o.timeSlice)}),l={left:[],right:[],recordingLength:0}):setTimeout(S,o.timeSlice))}}function dt(r,i){if("undefined"==typeof html2canvas)throw"Please link: https://www.webrtc-experiment.com/screenshot.js";(i=i||{}).frameInterval||(i.frameInterval=10);var n,o,a,s=!1,e=(["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(s=!0)}),!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome)),t=50,f=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(e&&f&&f[2]&&(t=parseInt(f[2],10)),e&&t<52&&(s=!1),s=i.useWhammyRecorder?!1:s)if(i.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),r instanceof HTMLCanvasElement)n=r;else{if(!(r instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";n=r.canvas}else navigator.mozGetUserMedia&&(i.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));this.record=function(){if(a=!0,s&&!i.useWhammyRecorder){var e;"captureStream"in n?e=n.captureStream(25):"mozCaptureStream"in n?e=n.mozCaptureStream(25):"webkitCaptureStream"in n&&(e=n.webkitCaptureStream(25));try{var t=new tt;t.addTrack(A(e,"video")[0]),e=t}catch(e){}if(!e)throw"captureStream API are NOT available.";(o=new ct(e,{mimeType:i.mimeType||"video/webm"})).record()}else l.frames=[],d=(new Date).getTime(),u();i.initCallback&&i.initCallback()},this.getWebPImages=function(e){var o;"canvas"===r.nodeName.toLowerCase()&&(o=l.frames.length,l.frames.forEach(function(e,t){var n=o-t,n=(i.disableLogs||console.log(n+"/"+o+" frames remaining"),i.onEncodingCallback&&i.onEncodingCallback(n,o),e.image.toDataURL("image/webp",1));l.frames[t].image=n}),i.disableLogs||console.log("Generating WebM")),e()};var c=!(this.stop=function(t){a=!1;var n=this;s&&o?o.stop(t):this.getWebPImages(function(){l.compile(function(e){i.disableLogs||console.log("Recording finished!"),n.blob=e,n.blob.forEach&&(n.blob=new Blob([],{type:"video/webm"})),t&&t(n.blob),l.frames=[]})})});function h(){l.frames=[],c=a=!1}function u(){return c?(d=(new Date).getTime(),setTimeout(u,500)):"canvas"===r.nodeName.toLowerCase()?(e=(new Date).getTime()-d,d=(new Date).getTime(),l.frames.push({image:(t=document.createElement("canvas"),n=t.getContext("2d"),t.width=r.width,t.height=r.height,n.drawImage(r,0,0),t),duration:e}),void(a&&setTimeout(u,i.frameInterval))):void html2canvas(r,{grabMouse:void 0===i.showMousePointer||i.showMousePointer,onrendered:function(e){var t=(new Date).getTime()-d;if(!t)return setTimeout(u,i.frameInterval);d=(new Date).getTime(),l.frames.push({image:e.toDataURL("image/webp",1),duration:t}),a&&setTimeout(u,i.frameInterval)}});var e,t,n}this.pause=function(){c=!0,o instanceof ct&&o.pause()},this.resume=function(){c=!1,o instanceof ct?o.resume():a||this.record()},this.clearRecordedData=function(){a&&this.stop(h),h()},this.name="CanvasRecorder",this.toString=function(){return this.name};var d=(new Date).getTime(),l=new ft.Video(100)}function lt(t,o){function n(e){e=void 0!==e?e:10;var t=(new Date).getTime()-s;return t?i?(s=(new Date).getTime(),setTimeout(n,100)):(s=(new Date).getTime(),a.paused&&a.play(),u.drawImage(a,0,0,y.width,y.height),c.frames.push({duration:t,image:y.toDataURL("image/webp")}),void(r||setTimeout(n,e,e))):setTimeout(n,e,e)}function d(n,e,t,o,c){var r,i,a,s=document.createElement("canvas"),f=(s.width=y.width,s.height=y.height,s.getContext("2d")),d=[],h=-1===e,u=e&&0<e&&e<=n.length?e:n.length,p=0,m=0,g=0,v=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),b=t&&0<=t&&t<=1?t:0,w=o&&0<=o&&o<=1?o:0,l=!1;i=-1,a=(r={length:u,functionToLoop:function(e,t){function i(){!l&&c-a<=c*w||(h&&(l=!0),d.push(n[t])),e()}var a,s,c,u;l?i():((u=new Image).onload=function(){f.drawImage(u,0,0,y.width,y.height);var e=f.getImageData(0,0,y.width,y.height);a=0,s=e.data.length,c=e.data.length/4;for(var t=0;t<s;t+=4){var n=e.data[t],o=e.data[t+1],r=e.data[t+2];Math.sqrt(Math.pow(n-p,2)+Math.pow(o-m,2)+Math.pow(r-g,2))<=v*b&&a++}i()},u.src=n[t].image)},callback:function(){(d=d.concat(n.slice(u))).length<=0&&d.push(n[n.length-1]),c(d)}}).length,function e(){++i!==a?setTimeout(function(){r.functionToLoop(e,i)},1):r.callback()}()}(o=o||{}).frameInterval||(o.frameInterval=10),o.disableLogs||console.log("Using frames-interval:",o.frameInterval);var r=!(this.record=function(){o.width||(o.width=320),o.height||(o.height=240),o.video||(o.video={width:o.width,height:o.height}),o.canvas||(o.canvas={width:o.width,height:o.height}),y.width=o.canvas.width||320,y.height=o.canvas.height||240,u=y.getContext("2d"),o.video&&o.video instanceof HTMLVideoElement?(a=o.video.cloneNode(),o.initCallback&&o.initCallback()):(a=document.createElement("video"),it(t,a),a.onloadedmetadata=function(){o.initCallback&&o.initCallback()},a.width=o.video.width,a.height=o.video.height),a.muted=!0,a.play(),s=(new Date).getTime(),c=new ft.Video,o.disableLogs||(console.log("canvas resolutions",y.width,"*",y.height),console.log("video width/height",a.width||y.width,"*",a.height||y.height)),n(o.frameInterval)}),i=!(this.stop=function(t){t=t||function(){},r=!0;var n=this;setTimeout(function(){d(c.frames,-1,null,null,function(e){c.frames=e,o.advertisement&&o.advertisement.length&&(c.frames=o.advertisement.concat(c.frames)),c.compile(function(e){n.blob=e,n.blob.forEach&&(n.blob=new Blob([],{type:"video/webm"})),t&&t(n.blob)})})},10)});function e(){c.frames=[],i=!(r=!0)}this.pause=function(){i=!0},this.resume=function(){i=!1,r&&this.record()},this.clearRecordedData=function(){r||this.stop(e),e()},this.name="WhammyRecorder",this.toString=function(){return this.name};var a,s,c,y=document.createElement("canvas"),u=y.getContext("2d")}void 0!==V?at.AudioContext=V:"undefined"!=typeof webkitAudioContext&&(at.AudioContext=webkitAudioContext),void 0!==T&&(T.Storage=at),void 0!==T&&(T.MediaStreamRecorder=ct),void 0!==T&&(T.StereoAudioRecorder=ut),void 0!==T&&(T.CanvasRecorder=dt),void 0!==T&&(T.WhammyRecorder=lt),ht.prototype.add=function(e,t){if("toDataURL"in(e="canvas"in e?e.canvas:e)&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},ht.prototype.compile=function(t){n=pt,n=C.createObjectURL(new Blob([n.toString(),"this.onmessage =  function (eee) {"+n.name+"(eee.data);}"],{type:"application/javascript"})),e=new Worker(n),C.revokeObjectURL(n);var e,n=e;n.onmessage=function(e){e.data.error?console.error(e.data.error):t(e.data)},n.postMessage(this.frames)};var ft={Video:ht};function ht(e){this.frames=[],this.duration=e||1,this.quality=.8}function pt(e){function u(e){for(var t=[];0<e;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function d(e){return new Uint8Array(e.split("").map(function(e){return e.charCodeAt(0)}))}function l(e){var t=[];e=(e.length%8?new Array(9-e.length%8).join("0"):"")+e;for(var n=0;n<e.length;n+=8)t.push(parseInt(e.substr(n,8),2));return new Uint8Array(t)}function a(e){for(var t=0,n={};t<e.length;){var o=e.substr(t,4),r=(r=t,parseInt(e.substr(r+4,4).split("").map(function(e){e=e.charCodeAt(0).toString(2);return new Array(8-e.length+1).join("0")+e}).join(""),2)),i=e.substr(t+4+4,r);t+=8+r,n[o]=n[o]||[],"RIFF"===o||"LIST"===o?n[o].push(a(i)):n[o].push(i)}return n}e=new function(e){var t=function(e){if(e[0]){for(var t=e[0].width,n=e[0].height,o=e[0].duration,r=1;r<e.length;r++)o+=e[r].duration;return{duration:o,width:t,height:n}}postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."})}(e);if(!t)return[];for(var n,o=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(n=t.duration,[].slice.call(new Uint8Array(new Float64Array([n]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:t.width,id:176},{data:t.height,id:186}]}]}]}]}],r=0,i=0;r<e.length;){for(var a=[],s=0;a.push(e[r]),s+=e[r].duration,++r<e.length&&s<3e4;);var c={id:524531317,data:function(e,n,t){return[{data:e,id:231}].concat(t.map(function(e){var t=function(e){var t=0;e.keyframe&&(t|=128);e.invisible&&(t|=8);e.lacing&&(t|=e.lacing<<1);e.discardable&&(t|=1);if(127<e.trackNum)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame}({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(n)});return n+=e.duration,{data:t,id:163}}))}(i,0,a)};o[1].data.push(c),i+=s}return function e(t){var n=[];for(var o=0;o<t.length;o++){var r=t[o].data,i=(r="string"==typeof(r="number"==typeof(r="object"==typeof r?e(r):r)?l(r.toString(2)):r)?d(r):r).size||r.byteLength||r.length,a=Math.ceil(Math.ceil(Math.log(i)/Math.log(2))/8),i=i.toString(2),i=new Array(7*a+7+1-i.length).join("0")+i,a=new Array(a).join("0")+"1"+i;n.push(u(t[o].id)),n.push(l(a)),n.push(r)}return new Blob(n,{type:"video/webm"})}(o)}(e.map(function(e){var t=function(e){for(var t=e.RIFF[0].WEBP[0],n=t.indexOf("*"),o=0,r=[];o<4;o++)r[o]=t.charCodeAt(n+3+o);return{width:16383&(r[1]<<8|r[0]),height:16383&(r[3]<<8|r[2]),data:t,riff:e}}(a(atob(e.image.slice(23))));return t.duration=e.duration,t}));postMessage(e)}void 0!==T&&(T.Whammy=ft);var mt={init:function(){var e,n,t,o=this;function r(e){e.createObjectStore(o.dataStoreName)}function i(){var e=n.transaction([o.dataStoreName],"readwrite");function t(t){e.objectStore(o.dataStoreName).get(t).onsuccess=function(e){o.callback&&o.callback(e.target.result,t)}}o.videoBlob&&e.objectStore(o.dataStoreName).put(o.videoBlob,"videoBlob"),o.gifBlob&&e.objectStore(o.dataStoreName).put(o.gifBlob,"gifBlob"),o.audioBlob&&e.objectStore(o.dataStoreName).put(o.audioBlob,"audioBlob"),t("audioBlob"),t("videoBlob"),t("gifBlob")}"undefined"!=typeof indexedDB&&void 0!==indexedDB.open?(e=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),(t=indexedDB.open(e,1)).onerror=o.onError,t.onsuccess=function(){(n=t.result).onerror=o.onError,n.setVersion&&1!==n.version?n.setVersion(1).onsuccess=function(){r(n),i()}:i()},t.onupgradeneeded=function(e){r(e.target.result)}):console.error("IndexedDB API are not available in this browser.")},Fetch:function(e){return this.callback=e,this.init(),this},Store:function(e){return this.audioBlob=e.audioBlob,this.videoBlob=e.videoBlob,this.gifBlob=e.gifBlob,this.init(),this},onError:function(e){console.error(JSON.stringify(e,null,"\t"))},dataStoreName:"recordRTC",dbName:null};function gt(e,n){"undefined"==typeof GIFEncoder&&((d=document.createElement("script")).src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(d)),n=n||{};var d,o=e instanceof CanvasRenderingContext2D||e instanceof HTMLCanvasElement,r=(this.record=function(){"undefined"!=typeof GIFEncoder&&t?(o||(n.width||(n.width=i.offsetWidth||320),n.height||(n.height=i.offsetHeight||240),n.video||(n.video={width:n.width,height:n.height}),n.canvas||(n.canvas={width:n.width,height:n.height}),s.width=n.canvas.width||320,s.height=n.canvas.height||240,i.width=n.video.width||320,i.height=n.video.height||240),(a=new GIFEncoder).setRepeat(0),a.setDelay(n.frameRate||200),a.setQuality(n.quality||10),a.start(),"function"==typeof n.onGifRecordingStarted&&n.onGifRecordingStarted(),u=Je(function e(t){if(!0!==f.clearedRecordedData){if(r)return setTimeout(function(){e(t)},100);u=Je(e),t-l<90||(!o&&i.paused&&i.play(),o||c.drawImage(i,0,0,s.width,s.height),n.onGifPreview&&n.onGifPreview(s.toDataURL("image/png")),a.addFrame(c),l=t)}}),n.initCallback&&n.initCallback()):setTimeout(f.record,1e3)},!(this.stop=function(e){e=e||function(){},u&&Ke(u),this.blob=new Blob([new Uint8Array(a.stream().bin)],{type:"image/gif"}),e(this.blob),a.stream().bin=[]}));this.pause=function(){r=!0},this.resume=function(){r=!1},this.clearRecordedData=function(){f.clearedRecordedData=!0,a&&(a.stream().bin=[])},this.name="GifRecorder",this.toString=function(){return this.name};var i,l,a,s=document.createElement("canvas"),c=s.getContext("2d"),t=(o&&(e instanceof CanvasRenderingContext2D?s=(c=e).canvas:e instanceof HTMLCanvasElement&&(c=e.getContext("2d"),s=e)),!0),u=(o||((i=document.createElement("video")).muted=!0,i.autoplay=!0,i.playsInline=!0,t=!1,i.onloadedmetadata=function(){t=!0},it(e,i),i.play()),null),f=this}function vt(o,r){r=r||"multi-streams-mixer";var i=[],a=!1,s=document.createElement("canvas"),c=s.getContext("2d"),u=(s.style.opacity=0,s.style.position="absolute",s.style.zIndex=-1,s.style.top="-1000em",s.style.left="-1000em",s.className=r,(document.body||document.documentElement).appendChild(s),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0,this),e=window.AudioContext,t=(void 0===e&&("undefined"!=typeof webkitAudioContext&&(e=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(e=mozAudioContext)),window.URL),d=(void 0===t&&"undefined"!=typeof webkitURL&&(t=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia)),window.MediaStream),l=(void 0!==(d=void 0===d&&"undefined"!=typeof webkitMediaStream?webkitMediaStream:d)&&void 0===d.prototype.stop&&(d.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})}),{});function f(){var e,t,n;a||(e=i.length,t=!1,n=[],i.forEach(function(e){e.stream||(e.stream={}),e.stream.fullcanvas?t=e:n.push(e)}),t?(s.width=t.stream.width,s.height=t.stream.height):n.length?(s.width=1<e?2*n[0].width:n[0].width,s.height=n[0].height*(9!==e&&10!==e?7!==e&&8!==e?5!==e&&6!==e?3!==e&&4!==e?1:2:3:4:5)):(s.width=u.width||360,s.height=u.height||240),t&&t instanceof HTMLVideoElement&&h(t),n.forEach(function(e,t){h(e,t)}),setTimeout(f,u.frameInterval))}function h(e,t){var n,o,r,i;a||(o=n=0,r=e.width,i=e.height,1===t&&(n=e.width),2===t&&(o=e.height),3===t&&(n=e.width,o=e.height),4===t&&(o=2*e.height),5===t&&(n=e.width,o=2*e.height),6===t&&(o=3*e.height),7===t&&(n=e.width,o=3*e.height),void 0!==e.stream.left&&(n=e.stream.left),void 0!==e.stream.top&&(o=e.stream.top),void 0!==e.stream.width&&(r=e.stream.width),void 0!==e.stream.height&&(i=e.stream.height),c.drawImage(e,n,o,r,i),"function"==typeof e.stream.onRender&&e.stream.onRender(c,n,o,r,i,t))}function p(e){var t,n,o=document.createElement("video");return t=e,!("srcObject"in(n=o))&&"mozSrcObject"in n?n.mozSrcObject=t:n.srcObject=t,o.className=r,o.muted=!0,o.volume=0,o.width=e.width||u.width||360,o.height=e.height||u.height||240,o.play(),o}function m(e){i=[],(e=e||o).forEach(function(e){var t;e.getTracks().filter(function(e){return"video"===e.kind}).length&&((t=p(e)).stream=e,i.push(t))})}void 0!==e?l.AudioContext=e:"undefined"!=typeof webkitAudioContext&&(l.AudioContext=webkitAudioContext),this.startDrawingFrames=function(){f()},this.appendStreams=function(e){if(!e)throw"First parameter is required.";(e=e instanceof Array?e:[e]).forEach(function(e){var t,n=new d;e.getTracks().filter(function(e){return"video"===e.kind}).length&&((t=p(e)).stream=e,i.push(t),n.addTrack(e.getTracks().filter(function(e){return"video"===e.kind})[0])),e.getTracks().filter(function(e){return"audio"===e.kind}).length&&(t=u.audioContext.createMediaStreamSource(e),u.audioDestination=u.audioContext.createMediaStreamDestination(),t.connect(u.audioDestination),n.addTrack(u.audioDestination.stream.getTracks().filter(function(e){return"audio"===e.kind})[0])),o.push(n)})},this.releaseStreams=function(){i=[],a=!0,u.gainNode&&(u.gainNode.disconnect(),u.gainNode=null),u.audioSources.length&&(u.audioSources.forEach(function(e){e.disconnect()}),u.audioSources=[]),u.audioDestination&&(u.audioDestination.disconnect(),u.audioDestination=null),u.audioContext&&u.audioContext.close(),u.audioContext=null,c.clearRect(0,0,s.width,s.height),s.stream&&(s.stream.stop(),s.stream=null)},this.resetVideoStreams=function(e){m(e=!e||e instanceof Array?e:[e])},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function(){a=!1,m(),"captureStream"in s?e=s.captureStream():"mozCaptureStream"in s?e=s.mozCaptureStream():u.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features"),t=new d,e.getTracks().filter(function(e){return"video"===e.kind}).forEach(function(e){t.addTrack(e)});var t,n=s.stream=t,e=function(){l.AudioContextConstructor||(l.AudioContextConstructor=new l.AudioContext);u.audioContext=l.AudioContextConstructor,u.audioSources=[],!0===u.useGainNode&&(u.gainNode=u.audioContext.createGain(),u.gainNode.connect(u.audioContext.destination),u.gainNode.gain.value=0);var n=0;if(o.forEach(function(e){if(!e.getTracks().filter(function(e){return e.kind==="audio"}).length)return;n++;var t=u.audioContext.createMediaStreamSource(e);if(u.useGainNode===true)t.connect(u.gainNode);u.audioSources.push(t)}),n)return u.audioDestination=u.audioContext.createMediaStreamDestination(),u.audioSources.forEach(function(e){e.connect(u.audioDestination)}),u.audioDestination.stream}();return e&&e.getTracks().filter(function(e){return"audio"===e.kind}).forEach(function(e){n.addTrack(e)}),o.forEach(function(e){e.fullcanvas}),n}}function bt(n,o){n=n||[];var r,i,a=this;(o=o||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}}).frameInterval||(o.frameInterval=10),o.video||(o.video={}),o.video.width||(o.video.width=360),o.video.height||(o.video.height=240),this.record=function(){var t;r=new vt(n,o.elementClass||"multi-streams-mixer"),t=[],n.forEach(function(e){A(e,"video").forEach(function(e){t.push(e)})}),t.length&&(r.frameInterval=o.frameInterval||10,r.width=o.video.width||360,r.height=o.video.height||240,r.startDrawingFrames()),o.previewStream&&"function"==typeof o.previewStream&&o.previewStream(r.getMixedStream()),(i=new ct(r.getMixedStream(),o)).record()},this.stop=function(t){i&&i.stop(function(e){a.blob=e,t(e),a.clearRecordedData()})},this.pause=function(){i&&i.pause()},this.resume=function(){i&&i.resume()},this.clearRecordedData=function(){i&&(i.clearRecordedData(),i=null),r&&(r.releaseStreams(),r=null)},this.addStreams=function(e){if(!e)throw"First parameter is required.";e instanceof Array||(e=[e]),n.concat(e),i&&r&&(r.appendStreams(e),o.previewStream&&"function"==typeof o.previewStream&&o.previewStream(r.getMixedStream()))},this.resetVideoStreams=function(e){r&&(!e||e instanceof Array||(e=[e]),r.resetVideoStreams(e))},this.getMixer=function(){return r},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}function wt(n,s){var c,o,r;function i(t,e){if(!s.workerPath&&!e)return c=!1,void fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(e){e.arrayBuffer().then(function(e){i(t,e)})});!s.workerPath&&e instanceof ArrayBuffer&&(e=new Blob([e],{type:"text/javascript"}),s.workerPath=C.createObjectURL(e)),s.workerPath||console.error("workerPath parameter is missing."),(o=new Worker(s.workerPath)).postMessage(s.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),o.addEventListener("message",function(e){"READY"===e.data?(o.postMessage({width:s.width,height:s.height,bitrate:s.bitrate||1200,timebaseDen:s.frameRate||30,realtime:s.realtime}),new ReadableStream({start:function(o){var r=document.createElement("canvas"),i=document.createElement("video"),a=!0;i.srcObject=n,i.muted=!0,i.height=s.height,i.width=s.width,i.volume=0,i.onplaying=function(){r.width=s.width,r.height=s.height;var e=r.getContext("2d"),t=1e3/s.frameRate,n=setInterval(function(){if(c&&(clearInterval(n),o.close()),a&&(a=!1,s.onVideoProcessStarted&&s.onVideoProcessStarted()),e.drawImage(i,0,0),"closed"!==o._controlledReadableStream.state)try{o.enqueue(e.getImageData(0,0,s.width,s.height))}catch(e){}},t)},i.play()}}).pipeTo(new WritableStream({write:function(e){c?console.error("Got image, but recorder is finished!"):o.postMessage(e.data.buffer,[e.data.buffer])}}))):e.data&&(r||a.push(e.data))})}"undefined"!=typeof ReadableStream&&"undefined"!=typeof WritableStream||console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),(s=s||{}).width=s.width||640,s.height=s.height||480,s.frameRate=s.frameRate||30,s.bitrate=s.bitrate||1200,s.realtime=s.realtime||!0,this.record=function(){r=!(a=[]),this.blob=null,i(n),"function"==typeof s.initCallback&&s.initCallback()},this.pause=function(){r=!0},this.resume=function(){r=!1};var a=[];this.stop=function(e){c=!0;var t,n=this;t=function(){n.blob=new Blob(a,{type:"video/webm"}),e(n.blob)},o?(o.addEventListener("message",function(e){null===e.data&&(o.terminate(),o=null,t&&t())}),o.postMessage(null)):t&&t()},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){r=!(a=[]),this.blob=null},this.blob=null}void 0!==T&&(T.DiskStorage=mt),void 0!==T&&(T.GifRecorder=gt),void 0===T&&(_.exports=vt),void 0!==T&&(T.MultiStreamRecorder=bt),void 0!==T&&(T.RecordRTCPromisesHandler=function(e,t){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(void 0===e)throw'First argument "MediaStream" is required.';var o=this;o.recordRTC=new T(e,t),this.startRecording=function(){return new Promise(function(e,t){try{o.recordRTC.startRecording(),e()}catch(e){t(e)}})},this.stopRecording=function(){return new Promise(function(t,n){try{o.recordRTC.stopRecording(function(e){o.blob=o.recordRTC.getBlob(),o.blob&&o.blob.size?t(e):n("Empty blob.",o.blob)})}catch(e){n(e)}})},this.pauseRecording=function(){return new Promise(function(e,t){try{o.recordRTC.pauseRecording(),e()}catch(e){t(e)}})},this.resumeRecording=function(){return new Promise(function(e,t){try{o.recordRTC.resumeRecording(),e()}catch(e){t(e)}})},this.getDataURL=function(e){return new Promise(function(t,n){try{o.recordRTC.getDataURL(function(e){t(e)})}catch(e){n(e)}})},this.getBlob=function(){return new Promise(function(e,t){try{e(o.recordRTC.getBlob())}catch(e){t(e)}})},this.getInternalRecorder=function(){return new Promise(function(e,t){try{e(o.recordRTC.getInternalRecorder())}catch(e){t(e)}})},this.reset=function(){return new Promise(function(e,t){try{e(o.recordRTC.reset())}catch(e){t(e)}})},this.destroy=function(){return new Promise(function(e,t){try{e(o.recordRTC.destroy())}catch(e){t(e)}})},this.getState=function(){return new Promise(function(e,t){try{e(o.recordRTC.getState())}catch(e){t(e)}})},this.blob=null,this.version="5.6.2"}),void 0!==T&&(T.WebAssemblyRecorder=wt);var yt=J.exports,Rt=(St.create=function(){return new this},St.prototype.getRequestCode=function(e){return _e.post("/face-actlive-session",e||{})},St.prototype.start=function(e,t){var t=t||{},n=t.encodeWidth,n=void 0===n?640:n,o=t.encodeHeight,o=void 0===o?480:o,r=t.encodeBitRate,r=void 0===r?18e4:r,i=t.encodeFPS,i=void 0===i?15:i,t=u(t,["encodeWidth","encodeHeight","encodeBitRate","encodeFPS"]),t=(this.params=t,new MediaStream([e.getMediaStreamTrack()]));return this.recorder=new yt(t,{type:"video",mimeType:"video/mp4",timeSlice:200,canvas:{width:n,height:o},bitrate:r,framerate:i}),this.recorder.startRecording(),this},St.prototype.commit=function(){var t=this;return new Promise(function(e){t.recorder.stopRecording(function(){e(t.recorder.getBlob())})}).then(function(t){return o=t,new Promise(function(t,e){var n=new FileReader;n.onload=function(e){t(e.target.result+"")},n.onerror=function(){e("Failed to read file!\n\n"+n.error)},n.readAsDataURL(o)}).then(function(e){return console.log("base64Result",e),e.replace("data:".concat(t.type,";base64,"),"")});var o}).then(function(e){return _e.post("/face-actlive-v2",s({video_base64:e},t.params))})},St);function St(){}Tt.create=function(){return new this},Tt.prototype.getRequestCode=function(e){return _e.post("/face-actlive-session",e||{})},Tt.prototype.start=function(e,t,n){var o=Rt.create();return this.faceActionLiveDetector=o.start(e,t),this.authoritativeFaceParams=n,this.videoTrack=e,this},Tt.prototype.commit=function(){return Promise.all([this.faceActionLiveDetector.commit(),qe.run(this.videoTrack,this.authoritativeFaceParams)]).then(function(e){return{faceActionResult:e[0],authoritativeFaceResult:e[1]}})};z=Tt;function Tt(){}Ct.run=function(e,t){var t=t||{},n=t.captureWidth,o=void 0===n?240:n,n=t.captureHeight,r=void 0===n?320:n,n=t.captureQuality,i=void 0===n?90:n,a=u(t,["captureWidth","captureHeight","captureQuality"]),n=e.getCurrentFrameData();return v.dataURLtoFile(n).then(function(e){return v.compress(e,{width:o,height:r,quality:i})}).then(function(e){return v.filetoDataURL(e)}).then(function(e){return _e.post("/face-compare-v2",[{image:e.replace(/^data:image\/\w+;base64,/,""),image_type:"BASE64",face_type:"LIVE"},a])})};e=Ct;function Ct(){}At.run=function(e,t){var t=t||{},n=t.captureWidth,o=void 0===n?240:n,n=t.captureHeight,r=void 0===n?320:n,n=t.captureQuality,i=void 0===n?90:n,a=u(t,["captureWidth","captureHeight","captureQuality"]),n=e.getCurrentFrameData();return v.dataURLtoFile(n).then(function(e){return v.compress(e,{width:o,height:r,quality:i})}).then(function(e){return v.filetoDataURL(e)}).then(function(e){return _e.post("/face-detect-v2",s({image:e.replace(/^data:image\/\w+;base64,/,""),image_type:"BASE64",face_type:"LIVE"},a))})};H=At;function At(){}Et.start=function(t,e){var e=e||15,n=new this;return n.frameRate=e,n.videoData=[],n.timer=setInterval(function(){var e=t.getCurrentFrameData().replace("data:image/png;base64,","");n.videoData.push({image:e})},1e3/e),n},Et.prototype.commit=function(){return clearInterval(this.timer),_e.post("/face-flashlive",{video_data:this.videoData})};Q=Et;function Et(){}kt.run=function(e,t){e=e.getCurrentFrameData();return _e.post("/ocr-idcard",s({image:e.replace("data:image/png;base64,","")},t))};N=kt;function kt(){}Ot.run=function(e){return _e.post("/general-ocr",{"data.uri":"data:application/octet-stream;base64,"+e.getCurrentFrameData().split(",")[1]})};M=Ot;function Ot(){}Lt.run=function(e){return _e.post("/voice-tts-v2",s({content:e.content},e))};L=Lt;function Lt(){}a.QNAudioToTextAnalyzer=i,a.QNAuthoritativeFaceComparer=qe,a.QNAuthorityActionFaceComparer=z,a.QNFaceActionLive=Rt,a.QNFaceComparer=e,a.QNFaceDetector=H,a.QNFaceFlashLiveDetector=Q,a.QNIDCardDetector=N,a.QNOCRDetector=M,a.QNRtcAiManager=c,a.QNTextToSpeakAnalyzer=L,a.version="4.1.0",Object.defineProperty(a,"__esModule",{value:!0})});
